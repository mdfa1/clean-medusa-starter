FROM node:20-alpine

# Install dependencies for building native modules
RUN apk add --no-cache \
    libc6-compat \
    python3 \
    make \
    g++ \
    wget \
    vips-dev \
    build-base

WORKDIR /app

# Copy package files first
COPY package.json yarn.lock* ./

# Install dependencies (including native modules like @swc/core)
RUN yarn install --frozen-lockfile

# Copy source code
COPY . .

# Expose port
EXPOSE 9000

# Start development server with hot-reload
CMD ["yarn", "dev"]

